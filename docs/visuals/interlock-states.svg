<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 940 780" font-family="Inter, system-ui, sans-serif">
  <defs>
    <style>
      .title { font-family: 'Space Grotesk', system-ui, sans-serif; font-weight: 700; }
      .subtitle { font-family: 'Space Grotesk', system-ui, sans-serif; font-weight: 500; }
      .label { font-size: 13px; fill: #1A1A2E; font-weight: 500; }
      .label-sm { font-size: 11px; fill: #6B7280; }
      .label-mono { font-family: 'JetBrains Mono', monospace; font-size: 11px; }
      .state-title { font-family: 'Space Grotesk', system-ui, sans-serif; font-size: 16px; font-weight: 700; }
      .state-desc { font-size: 12px; font-weight: 400; }
    </style>
    <marker id="arr" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#064E56" stroke-width="1.5"/>
    </marker>
    <marker id="arrAmber" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#F5A623" stroke-width="1.5"/>
    </marker>
    <filter id="shadow" x="-4%" y="-4%" width="108%" height="108%">
      <feDropShadow dx="0" dy="2" stdDeviation="4" flood-color="#1A1A2E" flood-opacity="0.08"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="940" height="780" fill="#F4F5F7" rx="12"/>

  <!-- Title -->
  <text x="470" y="38" text-anchor="middle" class="title" font-size="22" fill="#064E56">Interlock State Logic</text>
  <text x="470" y="58" text-anchor="middle" class="label-sm" font-size="12">Four states — AC and EV charger never operate simultaneously</text>

  <!-- ========================== -->
  <!-- STATE 1: IDLE (top-left) -->
  <!-- ========================== -->
  <rect x="50" y="90" width="340" height="150" rx="12" fill="#FFFFFF" stroke="#0A7E8C" stroke-width="2" filter="url(#shadow)"/>
  <rect x="50" y="90" width="340" height="6" rx="3" fill="#0A7E8C"/>
  <text x="220" y="128" text-anchor="middle" class="state-title" fill="#064E56">IDLE</text>
  <text x="220" y="150" text-anchor="middle" class="state-desc" fill="#6B7280">Both available, neither active</text>

  <rect x="100" y="165" width="100" height="28" rx="6" fill="#B8E4E9" opacity="0.5"/>
  <text x="150" y="183" text-anchor="middle" class="label-mono" fill="#0A7E8C">AC: off</text>
  <rect x="220" y="165" width="100" height="28" rx="6" fill="#B8E4E9" opacity="0.5"/>
  <text x="270" y="183" text-anchor="middle" class="label-mono" fill="#0A7E8C">EV: off</text>

  <!-- LED below status pills, clear of overlap -->
  <circle cx="105" cy="215" r="5" fill="none" stroke="#2ECC71" stroke-width="1.5"/>
  <text x="118" y="219" class="label-mono" fill="#6B7280" font-size="10">LED: off + blip every 10s</text>

  <!-- ============================== -->
  <!-- STATE 2: AC PRIORITY (top-right) — DEFAULT -->
  <!-- ============================== -->
  <rect x="550" y="90" width="340" height="150" rx="12" fill="#FFFFFF" stroke="#F5A623" stroke-width="2.5" filter="url(#shadow)"/>
  <rect x="550" y="90" width="340" height="6" rx="3" fill="#F5A623"/>
  <!-- Default badge -->
  <rect x="780" y="100" width="90" height="20" rx="10" fill="#F5A623"/>
  <text x="825" y="114" text-anchor="middle" font-size="10" font-weight="600" fill="#FFFFFF">DEFAULT</text>
  <text x="720" y="128" text-anchor="middle" class="state-title" fill="#064E56">AC HAS PRIORITY</text>
  <text x="720" y="150" text-anchor="middle" class="state-desc" fill="#6B7280">Thermostat calling — EV paused</text>

  <rect x="600" y="165" width="100" height="28" rx="6" fill="#F5A623" opacity="0.2"/>
  <text x="650" y="183" text-anchor="middle" class="label-mono" fill="#F5A623">AC: ON</text>
  <rect x="720" y="165" width="100" height="28" rx="6" fill="#E5E7EB"/>
  <text x="770" y="183" text-anchor="middle" class="label-mono" fill="#6B7280">EV: paused</text>

  <circle cx="605" cy="215" r="5" fill="#2ECC71"/>
  <text x="618" y="219" class="label-mono" fill="#6B7280" font-size="10">LED: heartbeat (200ms on / 1800ms off)</text>

  <!-- ============================== -->
  <!-- STATE 3: EV CHARGING (bottom-left) -->
  <!-- ============================== -->
  <rect x="50" y="410" width="340" height="150" rx="12" fill="#FFFFFF" stroke="#0A7E8C" stroke-width="2" filter="url(#shadow)"/>
  <rect x="50" y="410" width="340" height="6" rx="3" fill="#0A7E8C"/>
  <text x="220" y="448" text-anchor="middle" class="state-title" fill="#064E56">EV CHARGING</text>
  <text x="220" y="470" text-anchor="middle" class="state-desc" fill="#6B7280">Car drawing power — AC idle</text>

  <rect x="100" y="485" width="100" height="28" rx="6" fill="#E5E7EB"/>
  <text x="150" y="503" text-anchor="middle" class="label-mono" fill="#6B7280">AC: off</text>
  <rect x="220" y="485" width="100" height="28" rx="6" fill="#0A7E8C" opacity="0.2"/>
  <text x="270" y="503" text-anchor="middle" class="label-mono" fill="#0A7E8C">EV: ON</text>

  <circle cx="105" cy="535" r="5" fill="#2ECC71"/>
  <text x="118" y="539" class="label-mono" fill="#6B7280" font-size="10">LED: solid ON</text>

  <!-- ============================== -->
  <!-- STATE 4: NEVER HAPPENS (bottom-right) -->
  <!-- ============================== -->
  <rect x="550" y="410" width="340" height="150" rx="12" fill="#1A1A2E" stroke="#7B61FF" stroke-width="2.5" filter="url(#shadow)"/>
  <rect x="550" y="410" width="340" height="6" rx="3" fill="#7B61FF"/>

  <text x="720" y="448" text-anchor="middle" class="state-title" fill="#7B61FF" font-size="16">NEVER HAPPENS</text>
  <text x="720" y="468" text-anchor="middle" class="state-desc" fill="#6B7280">SideCharge prevents this state</text>

  <rect x="600" y="480" width="100" height="28" rx="6" fill="#7B61FF" opacity="0.15"/>
  <text x="650" y="498" text-anchor="middle" class="label-mono" fill="#7B61FF">AC: ON</text>
  <rect x="720" y="480" width="100" height="28" rx="6" fill="#7B61FF" opacity="0.15"/>
  <text x="770" y="498" text-anchor="middle" class="label-mono" fill="#7B61FF">EV: ON</text>

  <text x="720" y="530" text-anchor="middle" class="label-mono" fill="#7B61FF" font-size="10">HW + SW mutual exclusion</text>
  <text x="720" y="548" text-anchor="middle" class="label-mono" fill="#6B7280" font-size="10">Breaker trips as final backup</text>

  <!-- ========================== -->
  <!-- TRANSITIONS (no overlapping lines) -->
  <!-- ========================== -->

  <!-- IDLE → AC PRIORITY: thermostat calls (top, left-to-right) -->
  <line x1="395" y1="140" x2="545" y2="140" stroke="#064E56" stroke-width="2" marker-end="url(#arr)"/>
  <rect x="420" y="118" width="108" height="20" rx="4" fill="#FFF7E6" stroke="#F5A623" stroke-width="1"/>
  <text x="474" y="132" text-anchor="middle" class="label-mono" fill="#F5A623" font-size="10">cool_call HIGH</text>

  <!-- AC PRIORITY → IDLE: thermostat stops (top, right-to-left, below the first line) -->
  <line x1="545" y1="210" x2="395" y2="210" stroke="#064E56" stroke-width="2" marker-end="url(#arr)"/>
  <rect x="420" y="215" width="108" height="20" rx="4" fill="#E8F8FA" stroke="#0A7E8C" stroke-width="1"/>
  <text x="474" y="229" text-anchor="middle" class="label-mono" fill="#0A7E8C" font-size="10">cool_call LOW</text>

  <!-- IDLE → EV CHARGING: car plugs in (left side, top-to-bottom) -->
  <line x1="160" y1="245" x2="160" y2="405" stroke="#064E56" stroke-width="2" marker-end="url(#arr)"/>
  <rect x="90" y="310" width="108" height="20" rx="4" fill="#E8F8FA" stroke="#0A7E8C" stroke-width="1"/>
  <text x="144" y="324" text-anchor="middle" class="label-mono" fill="#0A7E8C" font-size="10">J1772 State C</text>

  <!-- EV CHARGING → IDLE: car unplugs (left side, bottom-to-top, offset right to avoid overlap) -->
  <line x1="290" y1="405" x2="290" y2="245" stroke="#064E56" stroke-width="2" marker-end="url(#arr)"/>
  <rect x="220" y="310" width="108" height="20" rx="4" fill="#E8F8FA" stroke="#0A7E8C" stroke-width="1"/>
  <text x="274" y="324" text-anchor="middle" class="label-mono" fill="#0A7E8C" font-size="10">J1772 State A</text>

  <!-- EV CHARGING → AC PRIORITY: THE KEY INTERLOCK TRANSITION -->
  <!-- Goes from bottom-right of EV box, up to bottom-left of AC box, via center channel -->
  <path d="M395,470 L470,470 L470,290 L545,200" fill="none" stroke="#F5A623" stroke-width="2.5" marker-end="url(#arrAmber)"/>
  <rect x="478" y="330" width="55" height="50" rx="6" fill="#FFF7E6" stroke="#F5A623" stroke-width="1.5"/>
  <text x="505" y="350" text-anchor="middle" class="label-mono" fill="#F5A623" font-size="9">AC calls</text>
  <text x="505" y="366" text-anchor="middle" class="label-mono" fill="#F5A623" font-size="9">EV yields</text>

  <!-- AC PRIORITY → EV CHARGING: AC done, car still plugged in -->
  <path d="M545,220 L510,290 L510,380 L395,480" fill="none" stroke="#0A7E8C" stroke-width="2" stroke-dasharray="6,3" marker-end="url(#arr)"/>
  <rect x="510" y="376" width="55" height="50" rx="6" fill="#E8F8FA" stroke="#0A7E8C" stroke-width="1"/>
  <text x="537" y="396" text-anchor="middle" class="label-mono" fill="#0A7E8C" font-size="9">AC done</text>
  <text x="537" y="412" text-anchor="middle" class="label-mono" fill="#0A7E8C" font-size="9">EV resumes</text>

  <!-- ========================== -->
  <!-- CHARGE NOW OVERRIDE ZONE -->
  <!-- ========================== -->
  <rect x="50" y="595" width="840" height="100" rx="10" fill="#FFFFFF" stroke="#7B61FF" stroke-width="1.5" stroke-dasharray="5,3" filter="url(#shadow)"/>
  <text x="75" y="620" class="subtitle" font-size="14" fill="#7B61FF">"Charge Now" Override</text>
  <text x="75" y="642" class="label-sm" fill="#6B7280">Physical button press temporarily reverses priority: EV charges, AC call is blocked for 30 min.</text>
  <text x="75" y="660" class="label-sm" fill="#6B7280">If thermostat calls continuously for 30+ min, override auto-cancels (thermal safety). Power cycle clears override (RAM-only).</text>
  <text x="75" y="680" class="label-mono" fill="#7B61FF" font-size="10">LED: 0.5Hz slow blink (1000ms on / 1000ms off)</text>

  <!-- ========================== -->
  <!-- KEY PRINCIPLE CALLOUT -->
  <!-- ========================== -->
  <rect x="50" y="710" width="840" height="45" rx="8" fill="#064E56"/>
  <text x="470" y="737" text-anchor="middle" class="subtitle" font-size="13" fill="#FFFFFF">AC always wins by default. The interlock is enforced in both hardware (fail-safe) and software (smart). Breaker provides final backup.</text>

  <!-- Footer -->
  <text x="470" y="775" text-anchor="middle" class="label-sm" fill="#6B7280" font-size="10">SideCharge by Eta Works · Hardware + software mutual exclusion · AC always wins (unless you press the button)</text>
</svg>